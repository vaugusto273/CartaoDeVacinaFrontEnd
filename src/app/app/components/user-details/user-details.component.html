<div *ngIf="loading" class="loading">
    Loading...
</div>

<div *ngIf="!loading && errorMessage" class="error">
    {{ errorMessage }}
</div>

<div *ngIf="!loading && users.length > 0" class="user-page">

    <!-- CARD DO USUÁRIO -->
    <div class="user-info-card">
        <div class="user-info-header">
            <span class="section-title">Vaccination Card</span>
        </div>

        <div class="user-info-body">
            <div class="user-info-row">

                <!-- SELECT DE USUÁRIO -->
                <div class="info-field">
                    <span class="label">User:</span>
                    <select [ngModel]="selectedUserId" (ngModelChange)="onUserChange($event)" class="user-select">
                        <option *ngFor="let u of users" [ngValue]="u.id">
                            {{ u.name }}
                        </option>
                    </select>
                </div>

                <div class="info-field small" *ngIf="user">
                    <span class="label">ID:</span>
                    <span class="value">{{ user.id }}</span>
                </div>

                <div class="info-field small">
                    <span class="label">Age:</span>
                    <span class="value">–</span>
                </div>
                <div class="info-field small">
                    <span class="label">Gender:</span>
                    <span class="value">–</span>
                </div>
            </div>
        </div>
    </div>

    <!-- ABAS VISUAIS -->
    <div class="tabs-container">
        <button class="tab active">National Vaccination Card</button>
        <button class="tab">Anti Rabies</button>
        <button class="tab">Contact BCG</button>
        <button class="tab">Private Vaccines</button>
        <button class="tab">Other Vaccines</button>
    </div>

    <!-- CARTÃO EM GRADE -->
    <div class="vaccine-card">

        <!-- LADO ESQUERDO: DOSES -->
        <div class="vaccine-sidebar">
            <div class="sidebar-header">
                <span>Vaccines</span>
                <span>Doses</span>
            </div>
            <div class="dose-row" *ngFor="let d of doseLevels">
                {{ doseLabel(d) }}
            </div>
        </div>

        <!-- GRID DE VACINAS x DOSES -->
        <div class="vaccine-grid-wrapper">

            <div *ngIf="vaccineColumns.length === 0" class="no-records">
                No vaccination records for this user.
            </div>

            <div *ngIf="vaccineColumns.length > 0" class="vaccine-grid">

                <!-- UMA COLUNA POR VACINA -->
                <div class="vaccine-grid-column" *ngFor="let vaccine of vaccineColumns">
                    <!-- cabeçalho da vacina -->
                    <div class="vaccine-grid-header">
                        {{ vaccine.vaccineName }}
                    </div>

                    <!-- células por dose -->
                    <div class="vaccine-grid-cell" *ngFor="let d of doseLevels" [ngClass]="{
              'taken': getRecordFor(vaccine.id, d),
              'missing': !getRecordFor(vaccine.id, d)
            }">
                        <ng-container *ngIf="getRecordFor(vaccine.id, d) as rec">
                            <div class="cell-notes">
                                {{ rec.notes || '' }}
                            </div>
                            <div class="cell-date">
                                {{ formatDate(rec.applicationDate) }}
                            </div>
                        </ng-container>
                    </div>
                </div>

            </div>
        </div>
    </div>
</div>